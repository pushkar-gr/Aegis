<!DOCTYPE html>
<html class="dark" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Reset Password - Service Dash</title>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&amp;display=swap" rel="stylesheet"/>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#13ec5b",
                        "primary-hover": "#0fb847",
                        "background-light": "#f6f8f6",
                        "background-dark": "#102216",
                        "surface-dark": "#111813",
                        "surface-highlight": "#28392e",
                        "text-muted": "#9db9a6",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"],
                        "mono": ["JetBrains Mono", "ui-monospace", "SFMono-Regular", "Menlo", "Monaco", "Consolas", "Liberation Mono", "Courier New", "monospace"],
                    },
                },
            },
        }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-surface-dark h-screen w-full flex overflow-hidden">
    <!-- Decorative Background -->
    <div class="absolute inset-0 overflow-hidden pointer-events-none">
        <div class="absolute top-0 right-0 -mr-20 -mt-20 w-96 h-96 bg-primary/5 rounded-full blur-3xl"></div>
        <div class="absolute bottom-0 left-0 -ml-20 -mb-20 w-96 h-96 bg-primary/5 rounded-full blur-3xl"></div>
    </div>

    <div class="w-full flex flex-col items-center justify-center p-6 relative z-10">
        <!-- Logo/Header -->
        <div class="text-center mb-8">
            <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-surface-highlight border border-white/10 shadow-[0_0_15px_rgba(19,236,91,0.2)] mb-4">
                <span class="material-symbols-outlined text-3xl text-primary">lock_reset</span>
            </div>
            <h2 class="text-3xl font-bold text-white tracking-tight">Reset Password</h2>
            <p class="text-sm text-text-muted mt-2">Secure your account with a new password.</p>
        </div>

        <!-- Form Card -->
        <div class="w-full max-w-md bg-surface-highlight/40 backdrop-blur-md rounded-2xl shadow-2xl border border-white/10 p-8">
            <form id="resetPasswordForm" class="space-y-6">
                <!-- Error Message Container -->
                <div id="messageContainer" class="hidden p-4 rounded-lg text-sm border"></div>

                <div class="space-y-1.5">
                    <label class="block text-xs font-bold text-gray-300 uppercase tracking-wider ml-1" for="oldPassword">Current Password</label>
                    <div class="relative group">
                        <div class="absolute inset-y-0 left-0 pl-3.5 flex items-center pointer-events-none">
                            <span class="material-symbols-outlined text-gray-500 group-focus-within:text-primary transition-colors text-[20px]">key</span>
                        </div>
                        <input autocomplete="current-password" class="block w-full pl-11 pr-4 py-3 border-0 ring-1 ring-inset ring-white/10 rounded-lg text-white placeholder:text-gray-600 focus:ring-2 focus:ring-inset focus:ring-primary/60 sm:text-sm sm:leading-6 bg-black/20 focus:bg-black/40 transition-all duration-200" id="oldPassword" required type="password" placeholder="••••••••"/>
                    </div>
                </div>

                <div class="space-y-1.5">
                    <label class="block text-xs font-bold text-gray-300 uppercase tracking-wider ml-1" for="newPassword">New Password</label>
                    <div class="relative group">
                        <div class="absolute inset-y-0 left-0 pl-3.5 flex items-center pointer-events-none">
                            <span class="material-symbols-outlined text-gray-500 group-focus-within:text-primary transition-colors text-[20px]">lock</span>
                        </div>
                        <input autocomplete="new-password" class="block w-full pl-11 pr-4 py-3 border-0 ring-1 ring-inset ring-white/10 rounded-lg text-white placeholder:text-gray-600 focus:ring-2 focus:ring-inset focus:ring-primary/60 sm:text-sm sm:leading-6 bg-black/20 focus:bg-black/40 transition-all duration-200" id="newPassword" required type="password" placeholder="New strong password"/>
                    </div>
                </div>

                <div class="space-y-1.5">
                    <label class="block text-xs font-bold text-gray-300 uppercase tracking-wider ml-1" for="confirmPassword">Confirm Password</label>
                    <div class="relative group">
                        <div class="absolute inset-y-0 left-0 pl-3.5 flex items-center pointer-events-none">
                            <span class="material-symbols-outlined text-gray-500 group-focus-within:text-primary transition-colors text-[20px]">check_circle</span>
                        </div>
                        <input autocomplete="new-password" class="block w-full pl-11 pr-4 py-3 border-0 ring-1 ring-inset ring-white/10 rounded-lg text-white placeholder:text-gray-600 focus:ring-2 focus:ring-inset focus:ring-primary/60 sm:text-sm sm:leading-6 bg-black/20 focus:bg-black/40 transition-all duration-200" id="confirmPassword" required type="password" placeholder="Confirm new password"/>
                    </div>
                </div>

                <div class="flex flex-col gap-3 pt-2">
                    <button class="w-full flex justify-center py-3.5 px-4 border border-transparent rounded-lg shadow-lg shadow-primary/20 text-sm font-bold text-surface-dark bg-primary hover:bg-primary-hover focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-surface-dark focus:ring-primary transition-all duration-200 transform active:scale-[0.99] uppercase tracking-wider" type="submit">
                        Update Password
                    </button>
                    <a href="/static/pages/dashboard.html" class="w-full flex justify-center py-3.5 px-4 rounded-lg border border-white/10 text-sm font-bold text-text-muted hover:text-white hover:bg-surface-highlight transition-all uppercase tracking-wider">
                        Cancel
                    </a>
                </div>
            </form>
        </div>
        
        <p class="text-center text-xs text-gray-600 mt-8 font-mono">
            Aegis Secure System • Service Dash
        </p>
    </div>

    <!-- Loading Spinner -->
    <div id="loadingSpinner" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 hidden">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary"></div>
    </div>

    <script src="/static/js/api.js"></script>
    <script src="/static/js/components.js"></script>
    <script>
        if (!requireAuth()) {
            // API.js handles redirection
        }

        document.getElementById('resetPasswordForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const oldPassword = document.getElementById('oldPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const msgContainer = document.getElementById('messageContainer');
            
            // Basic validation
            if (newPassword !== confirmPassword) {
                showMessage('New passwords do not match.', 'error');
                return;
            }
            if (newPassword.length < 6) {
                showMessage('Password must be at least 6 characters.', 'error');
                return;
            }

            try {
                showLoading(); // Assuming showLoading is in components.js or defined inline
                await API.updatePassword(oldPassword, newPassword);
                
                showMessage('Password updated successfully! Redirecting...', 'success');
                document.getElementById('resetPasswordForm').reset();
                
                setTimeout(() => {
                    window.location.href = '/static/pages/dashboard.html';
                }, 2000);
                
            } catch (error) {
                showMessage(error.message || 'Failed to update password.', 'error');
            } finally {
                hideLoading();
            }
        });

        function showMessage(msg, type) {
            const container = document.getElementById('messageContainer');
            container.textContent = msg;
            container.classList.remove('hidden', 'bg-red-900/20', 'border-red-500/20', 'text-red-400', 'bg-green-900/20', 'border-green-500/20', 'text-green-400');
            
            if (type === 'error') {
                container.classList.add('bg-red-900/20', 'border-red-500/20', 'text-red-400');
            } else {
                container.classList.add('bg-green-900/20', 'border-green-500/20', 'text-green-400');
            }
            container.classList.remove('hidden');
        }
    </script>
</body>
</html>
